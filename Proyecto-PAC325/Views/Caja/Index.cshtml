@model List<Proyecto_PAC325.Models.CajaModel>
@{
    ViewData["Title"] = "Cajas";
    var idComercio = ViewBag.IdComercio as int? ?? 0;
}
@if (TempData["error"] != null)
{
    <div class="mensaje error" id="mensaje">
        <span>@TempData["error"]</span>
        <button id="cerrar-modal">×</button>
    </div>
}
else if (TempData["success"] != null)
{
    <div class="mensaje success" id="mensaje">
        <span>@TempData["success"]</span>
        <button id="cerrar-modal">×</button>
    </div>
}
<section class="bienvenida">
    <div>
        <p>Apartado de Cajas</p>
        <h1>ESTE ES EL APARTADO DE CAJAS</h1>
        <p>Las cajas listadas representan los teléfonos asociados a cada comercio para recibir SINPE.</p>
    </div>
</section>

<div class="titulo-container"><h2>CAJAS DEL COMERCIO</h2></div>

<div class="act-container">
    <h3>Acciones: </h3>
    <a class="activo" asp-action="Index" asp-route-idComercio="@idComercio">Lista</a>
    <a asp-action="Registro" asp-route-idComercio="@idComercio">Registrar</a>
</div>

<section class="vista-tabla">
    <section class="tabla-container">
        <table class="tabla">
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>Descripción</th>
                    <th>Teléfono SINPE</th>
                    <th>Fecha de registro</th>
                    <th>Estado</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                @if (Model == null || !Model.Any())
                {
                    <tr>
                        <td colspan="6" style="text-align:center; padding:2rem;">
                            No hay cajas para mostrar.
                            @if (idComercio == 0)
                            {
                                <div>(No se recibió idComercio.)</div>
                            }
                        </td>
                    </tr>
                }
                else
                {
                    @foreach (var c in Model)
                    {
                        <tr>
                            <td>@c.Nombre</td>
                            <td>@(string.IsNullOrEmpty(c.Descripcion) ? "" : (c.Descripcion.Length > 30 ? c.Descripcion.Substring(0, 30) + "…" : c.Descripcion))</td>
                            <td>@(string.IsNullOrWhiteSpace(c.TelefonoSINPE) ? "-" : c.TelefonoSINPE)</td>
                            <td>@c.FechaDeRegistro.ToString("g")</td>
                            <td>@(c.Estado == 1 ? "Activo" : "Inactivo")</td>
                            <td>
                                <a class="boton bg-success" asp-action="Editar" asp-route-idCaja="@c.IdCaja">Editar</a>
                                <a class="boton bg-oscuro" asp-action="SinpesPorCaja" asp-route-telefono="@c.TelefonoSINPE">Ver SINPE</a>
                            </td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </section>
</section>
